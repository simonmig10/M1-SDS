---
title: "Assignment 1"
output: html_document
---

#Before we start

Running libaries 

```{r}
library(tidyverse)

library(lubridate)

library(magrittr)

```


Loading data 

```{r}
trips= read_csv("https://sds-aau.github.io/SDS-master/M1/data/trips.csv", show_col_types = FALSE)

people= read_csv("https://sds-aau.github.io/SDS-master/M1/data/people.csv", show_col_types = FALSE)

country= read_csv("https://sds-aau.github.io/SDS-master/M1/data/countrylist.csv", show_col_types = FALSE)

```


Looking at the data: 

```{r}
glimpse(trips)

glimpse(people)

glimpse(country)
```



#Preprocessing

*Trips: transform dates into timestamps (note: in Python, you will have to coerce errors for faulty dates)*

```{r}
trips %<>%
  mutate(date_end_time= as.numeric(as.POSIXct(date_end, format="%Y-%m-%d")), date_start_time=as.numeric(as.POSIXct(date_start, format="%Y-%m-%d")))

trips

```


*Calculate trip duration in days (you can use loops, list comprehensions or map-lambda-functions (python) to create a column that holds the numerical value of the day. You can also use the datetime package.)*

```{r}
trips %<>% 
  mutate(trip_durration= date_end_time- date_start_time, trip_durration_days= trip_durration/86400)
```




*Filter extreme (fake?) observations for durations as well as dates - start and end (trips that last 234565 days / are in the 17th or 23rd century) The minimum duration of a trip is 1 day! Hint: use percentiles/quantiles to set boundaries for extreme values - between 1 and 97, calculate and store the boundaries before subsetting. Rhint: Use percent_rank(as.numeric(variable)) to create percentiles*

```{r}
trips %>%
  filter(!is.na(date_end_time))%>%
  filter(trip_durration_days >= 1 & trip_durration_days <= 97, date_end_time >= quantile(date_end_time, 0.01) & date_end_time <= quantile(date_end_time, 0.97))
  
  

```



*Join the countrylist data to the trips data-frame using the countrycode as a key e. [Only for python users ] Set DateTime index as the start date of a trip*

```{r}

trips%>%
  left_join(country, by= c("country_code" = "alpha_2"))

```



#people 

*How many people have a least a “High School” diploma? Hint: For this calculation remove missing value-rows or fill with “False”.*
```{r}
people %>%
  drop_na(education_raw) %>%
  count()
```
First we drop the NAs. Thereafter we count the remainging observations as high school is presumed to be the lowest education in the category. From this we see that 451 people have at least a High School diploma.


*How many “Startup Founders” have attained a “Master’s Degree”? Bonus: compared to people who don’t have a formal higher education (e.g. by using the “False” occurrences)?*
```{r}
people %>%
  filter(grepl("Startup Founder", work_raw)) %>%
  filter(grepl("Master",education_raw)) %>%
  count()

people %>%
  filter(grepl("Startup Founder", work_raw)) %>%
  filter(!grepl("Master",education_raw)) %>%
  count()

```
Here we use the grepl command to filter by both the work_raw and education_raw. The grepl lets us filter by strings containing certain text. By doing this we get that 53 startup founders have attained a Master's Degree. By adding an "!" before the second grepl we can reverse the function so that we get all startup founders without a Master's degree. This shows us that 668 startup founders does not have a master's degree.

*Who is the person with a Master’s Degree that has the highest number of followers? Bonus: Explore the individual further, what else can you find out?*
```{r}
people %>%
  filter(grepl("Master's Degree", education_raw)) %>%
  arrange(desc(followers)) %>%
  head(1) %>%
  select(-X1)

```
To get the results we first filtered in the education_raw category by strings containing "Master's Degree". Afterwards we arranged by followers in descending order, so that the top result will be the person with most followers. Thereafter we write the "head(1)" function which excludes all results not in the top of the list. In the end we use the select function to exclude the ID of the person, because this is not relevant.
The result shows us, that the person with the most followers is @levelsio. He has 2182 followers. He follows 353. He is a software Dev, a startup founder and a creative. Furthermore he has a high school diploma, a bachelor's degree and a master's degree.

#Trips

*Which country received the highest number of trips? – And which the lowest?*

*Which region received the highest number of trips in 2017? Use the start of trips as a time reference.*

*Which country in “Western Europe” did travelers spent least time? – Provide visualization*

*Do nomad Startup Founders tend to have shorter or longer trips on average?*

*visualize over-time median trip duration overall (bonus: and split by world-region) The plot will look weird ^^. PyHint: Resample by week (‘W’) and calculate the size of observations. RHint: Use the floor_date function to reset dates by week.*